const e=()=>{let e,t;chrome.storage.local.set({transcript:""}),chrome.storage.local.get("key",(({key:t})=>e=t)),navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((a=>{if(!e)return alert("You must provide a Deepgram API Key in the options page.");if(0==a.getAudioTracks().length)return alert("Please share your tab with audio. Refresh the page.");if(!MediaRecorder.isTypeSupported("audio/webm"))return alert("Browser not supported");const r=new MediaRecorder(a,{mimeType:"audio/webm"});t=new WebSocket("wss://api.deepgram.com/v1/listen?model=general-enhanced&punctuate=true",["token",e]),t.onopen=()=>{console.log({event:"onopen"}),r.addEventListener("dataavailable",(async e=>{e.data.size>0&&1===t.readyState&&t.send(e.data)})),r.start(1e3)},t.onmessage=e=>{const t=JSON.parse(e.data).channel.alternatives[0].transcript;t&&chrome.storage.local.get("transcript",(e=>{chrome.storage.local.set({transcript:e.transcript+=" "+t}),chrome.runtime.sendMessage({message:"transcriptavailable"}).catch((e=>({})))}))}})),chrome.runtime.onMessage.addListener((({message:e})=>{"stop"==e&&(t.close(),alert("Transcription ended"))}))};function t(){chrome.storage.local.get("transcript",(({transcript:e})=>{document.getElementById("transcript").innerHTML=e,e&&document.getElementById("clear")?.removeAttribute("disabled")}))}async function a(){const[e]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});return console.log({tab:e}),e}t(),document.getElementById("start")?.addEventListener("click",(async()=>{const t=await a();if(!t)return alert("Require an active tab");chrome.scripting.executeScript({target:{tabId:t.id},func:e})})),document.getElementById("stop")?.addEventListener("click",(async()=>{const e=await a();if(!e)return alert("Require an active tab");chrome.tabs.sendMessage(e.id,{message:"stop"})})),chrome.runtime.onMessage.addListener((({message:e})=>{"transcriptavailable"==e&&t()})),document.getElementById("clear")?.addEventListener("click",(()=>(chrome.storage.local.set({transcript:""}),document.getElementById("transcript").innerHTML="",void(document.getElementById("clear").disabled=!0))));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJtYXBwaW5ncyI6IkFBQU8sTUFBTUEsRUFBVSxLQUV2QixJQUFJQyxFQUNBQyxFQUNKQyxPQUFPQyxRQUFRQyxNQUFNQyxJQUFJLENBQUVDLFdBQVksS0FDdkNKLE9BQU9DLFFBQVFDLE1BQU1HLElBQUksT0FBTyxFQUFDQyxJQUFFQSxLQUFVUixFQUFTUSxJQUl0REMsVUFBVUMsYUFBYUMsZ0JBQWdCLENBQUVDLE9BQU8sRUFBTUMsT0FBTyxJQUFRQyxNQUFNQyxJQUN2RSxJQUFJZixFQUFRLE9BQU9nQixNQUFNLDREQUN6QixHQUFxQyxHQUFsQ0QsRUFBT0UsaUJBQWlCQyxPQUFhLE9BQU9GLE1BQU0sdURBRXJELElBQUtHLGNBQWNDLGdCQUFnQixjQUMvQixPQUFPSixNQUFNLHlCQUNqQixNQUFNSyxFQUFnQixJQUFJRixjQUFjSixFQUFRLENBQzVDTyxTQUFVLGVBS2RyQixFQUFTLElBQUlzQixVQUFVLHlFQUEwRSxDQUFDLFFBQVN2QixJQUUzR0MsRUFBT3VCLE9BQVMsS0FDWkMsUUFBUUMsSUFBSSxDQUFFQyxNQUFPLFdBQ3JCTixFQUFjTyxpQkFBaUIsaUJBQWlCQyxNQUFPRixJQUMvQ0EsRUFBTUcsS0FBS0MsS0FBTyxHQUEyQixJQUF0QjlCLEVBQU8rQixZQUM5Qi9CLEVBQU9nQyxLQUFLTixFQUFNRyxLQUFLLElBRy9CVCxFQUFjYSxNQUFNLElBQUssRUFHN0JqQyxFQUFPa0MsVUFBYUMsSUFDaEIsTUFDTTlCLEVBRFcrQixLQUFLQyxNQUFNRixFQUFRTixNQUNSUyxRQUFRQyxhQUFhLEdBQUdsQyxXQUVoREEsR0FDQUosT0FBT0MsUUFBUUMsTUFBTUcsSUFBSSxjQUFjdUIsSUFDbkM1QixPQUFPQyxRQUFRQyxNQUFNQyxJQUFJLENBQUVDLFdBQVl3QixFQUFLeEIsWUFBYyxJQUFNQSxJQUdoRUosT0FBT3VDLFFBQVFDLFlBQVksQ0FBRU4sUUFBUyx3QkFBeUJPLE9BQU1DLElBQVEsQ0FBRSxJQUFFLEdBQ25GLENBRVQsSUFHTDFDLE9BQU91QyxRQUFRSSxVQUFVQyxhQUFZLEVBQUNWLFFBQUVBLE1BQ3RCLFFBQVhBLElBQ0NuQyxFQUFPOEMsUUFDUC9CLE1BQU0sdUIsR0FFWixFQzVCRixTQUFTZ0MsSUFDTDlDLE9BQU9DLFFBQVFDLE1BQU1HLElBQUksY0FBYyxFQUFDRCxXQUFFQSxNQUN2QzJDLFNBQVNDLGVBQWUsY0FBY0MsVUFBWTdDLEVBQ2xEQSxHQUFjMkMsU0FBU0MsZUFBZSxVQUFVRSxnQkFBZ0IsV0FBVyxHLENBWWxGdkIsZUFBZXdCLElBQ1gsTUFDT0MsU0FBYXBELE9BQU9xRCxLQUFLQyxNQURYLENBQUVDLFFBQVEsRUFBTUMsbUJBQW1CLElBR3hELE9BREFqQyxRQUFRQyxJQUFJLEMsSUFBQzRCLElBQ05BLEMsQ0ExQ1hOLElBRUFDLFNBQVNDLGVBQWUsVUFBVXRCLGlCQUFpQixTQUFTQyxVQUN4RCxNQUFNeUIsUUFBWUQsSUFDbEIsSUFBSUMsRUFBSyxPQUFPdEMsTUFBTSx5QkFDdEJkLE9BQU95RCxVQUFVQyxjQUFjLENBQzNCQyxPQUFRLENBQUVDLE1BQU9SLEVBQUlTLElBQ3JCQyxLQUFNakUsR0FDUixJQUdOa0QsU0FBU0MsZUFBZSxTQUFTdEIsaUJBQWlCLFNBQVNDLFVBQ3ZELE1BQU15QixRQUFZRCxJQUNsQixJQUFJQyxFQUFLLE9BQU90QyxNQUFNLHlCQUN0QmQsT0FBT3FELEtBQUtiLFlBQVlZLEVBQUlTLEdBQUksQ0FBRTNCLFFBQVMsUUFBUyxJQUd4RGxDLE9BQU91QyxRQUFRSSxVQUFVQyxhQUFZLEVBQUNWLFFBQUVBLE1BQ3RCLHVCQUFYQSxHQUNDWSxHQUFzQixJQWlCOUJDLFNBQVNDLGVBQWUsVUFBVXRCLGlCQUFpQixTQUFTLEtBTHhEMUIsT0FBT0MsUUFBUUMsTUFBTUMsSUFBSSxDQUFDQyxXQUFjLEtBQ3hDMkMsU0FBU0MsZUFBZSxjQUFjQyxVQUFZLFFBQ2xERixTQUFTQyxlQUFlLFNBQVNlLFVBQVciLCJzb3VyY2VzIjpbInNyYy9jb250ZW50LXNjcmlwdC50cyIsInNyYy9wb3B1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgY29udGVudCA9ICgpID0+IHtcblxubGV0IGFwaUtleVxubGV0IHNvY2tldFxuY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KHsgdHJhbnNjcmlwdDogJycgfSlcbmNocm9tZS5zdG9yYWdlLmxvY2FsLmdldCgna2V5JywgKHsga2V5IH0pID0+IGFwaUtleSA9IGtleSlcblxuXG4vL0FkZCBtaWNyb3Bob25lIGFjY2Vzc1xubmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXREaXNwbGF5TWVkaWEoeyB2aWRlbzogdHJ1ZSwgYXVkaW86IHRydWUgfSkudGhlbigoc3RyZWFtKSA9PiB7XG4gICAgaWYoIWFwaUtleSkgcmV0dXJuIGFsZXJ0KCdZb3UgbXVzdCBwcm92aWRlIGEgRGVlcGdyYW0gQVBJIEtleSBpbiB0aGUgb3B0aW9ucyBwYWdlLicpXG4gICAgaWYoc3RyZWFtLmdldEF1ZGlvVHJhY2tzKCkubGVuZ3RoID09IDApIHJldHVybiBhbGVydCgnUGxlYXNlIHNoYXJlIHlvdXIgdGFiIHdpdGggYXVkaW8uIFJlZnJlc2ggdGhlIHBhZ2UuJylcblxuICAgIGlmICghTWVkaWFSZWNvcmRlci5pc1R5cGVTdXBwb3J0ZWQoJ2F1ZGlvL3dlYm0nKSlcbiAgICAgICAgcmV0dXJuIGFsZXJ0KCdCcm93c2VyIG5vdCBzdXBwb3J0ZWQnKVxuICAgIGNvbnN0IG1lZGlhUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcihzdHJlYW0sIHtcbiAgICAgICAgbWltZVR5cGU6ICdhdWRpby93ZWJtJyxcbiAgICB9KVxuXG4vL2NyZWF0ZSBhIHdlYnNvY2tldCBjb25uZWN0aW9uXG5cbiAgICBzb2NrZXQgPSBuZXcgV2ViU29ja2V0KCd3c3M6Ly9hcGkuZGVlcGdyYW0uY29tL3YxL2xpc3Rlbj9tb2RlbD1nZW5lcmFsLWVuaGFuY2VkJnB1bmN0dWF0ZT10cnVlJywgWyd0b2tlbicsIGFwaUtleV0pXG5cbiAgICBzb2NrZXQub25vcGVuID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyh7IGV2ZW50OiAnb25vcGVuJyB9KVxuICAgICAgICBtZWRpYVJlY29yZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2RhdGFhdmFpbGFibGUnLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC5kYXRhLnNpemUgPiAwICYmIHNvY2tldC5yZWFkeVN0YXRlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgc29ja2V0LnNlbmQoZXZlbnQuZGF0YSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgbWVkaWFSZWNvcmRlci5zdGFydCgxMDAwKVxuICAgIH1cblxuICAgIHNvY2tldC5vbm1lc3NhZ2UgPSAobWVzc2FnZSkgPT4ge1xuICAgICAgICBjb25zdCByZWNlaXZlZCA9IEpTT04ucGFyc2UobWVzc2FnZS5kYXRhKVxuICAgICAgICBjb25zdCB0cmFuc2NyaXB0ID0gcmVjZWl2ZWQuY2hhbm5lbC5hbHRlcm5hdGl2ZXNbMF0udHJhbnNjcmlwdFxuXG4gICAgICAgIGlmICh0cmFuc2NyaXB0KSB7XG4gICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoJ3RyYW5zY3JpcHQnLCBkYXRhID0+IHtcbiAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoeyB0cmFuc2NyaXB0OiBkYXRhLnRyYW5zY3JpcHQgKz0gJyAnICsgdHJhbnNjcmlwdCB9KVxuXG4gICAgICAgICAgICAgICAgLy8gVGhyb3dzIGVycm9yIHdoZW4gcG9wdXAgaXMgY2xvc2VkLCBzbyB0aGlzIHN3YWxsb3dzIHRoZSBlcnJvcnMuXG4gICAgICAgICAgICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UoeyBtZXNzYWdlOiAndHJhbnNjcmlwdGF2YWlsYWJsZScgfSkuY2F0Y2goZXJyID0+ICh7fSkpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxufSlcblxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKCh7IG1lc3NhZ2UgfSkgPT4ge1xuICAgIGlmKG1lc3NhZ2UgPT0gJ3N0b3AnKSB7XG4gICAgICAgIHNvY2tldC5jbG9zZSgpXG4gICAgICAgIGFsZXJ0KCdUcmFuc2NyaXB0aW9uIGVuZGVkJylcbiAgICB9XG59KVxufTtcbiIsImltcG9ydCB7IGNvbnRlbnQgfSBmcm9tICcuL2NvbnRlbnQtc2NyaXB0Jztcblxuc2hvd0xhdGVzdFRyYW5zY3JpcHQoKVxuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdGFiID0gYXdhaXQgZ2V0Q3VycmVudFRhYigpXG4gICAgaWYoIXRhYikgcmV0dXJuIGFsZXJ0KCdSZXF1aXJlIGFuIGFjdGl2ZSB0YWInKVxuICAgIGNocm9tZS5zY3JpcHRpbmcuZXhlY3V0ZVNjcmlwdCh7XG4gICAgICAgIHRhcmdldDogeyB0YWJJZDogdGFiLmlkIH0sXG4gICAgICAgIGZ1bmM6IGNvbnRlbnQsXG4gICAgfSlcbn0pXG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9wJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHRhYiA9IGF3YWl0IGdldEN1cnJlbnRUYWIoKVxuICAgIGlmKCF0YWIpIHJldHVybiBhbGVydCgnUmVxdWlyZSBhbiBhY3RpdmUgdGFiJylcbiAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWIuaWQsIHsgbWVzc2FnZTogJ3N0b3AnIH0pXG59KVxuXG5jaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKHsgbWVzc2FnZSB9KSA9PiB7XG4gICAgaWYobWVzc2FnZSA9PSAndHJhbnNjcmlwdGF2YWlsYWJsZScpIHtcbiAgICAgICAgc2hvd0xhdGVzdFRyYW5zY3JpcHQoKVxuICAgIH1cbn0pXG5cbmZ1bmN0aW9uIHNob3dMYXRlc3RUcmFuc2NyaXB0KCkge1xuICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldChcInRyYW5zY3JpcHRcIiwgKHsgdHJhbnNjcmlwdCB9KSA9PiB7XG4gICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYW5zY3JpcHQnKS5pbm5lckhUTUwgPSB0cmFuc2NyaXB0O1xuICAgICAgIHRyYW5zY3JpcHQgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyJyk/LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9KVxufVxuXG5mdW5jdGlvbiBjbGVhclRyYW5zY3JpcHQoKSB7XG4gICAgY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KHtcInRyYW5zY3JpcHRcIjogXCJcIn0pO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmFuc2NyaXB0JykuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXInKS5kaXNhYmxlZCA9IHRydWU7XG59XG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhcicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGNsZWFyVHJhbnNjcmlwdCgpKVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50VGFiKCkge1xuICAgIGNvbnN0IHF1ZXJ5T3B0aW9ucyA9IHsgYWN0aXZlOiB0cnVlLCBsYXN0Rm9jdXNlZFdpbmRvdzogdHJ1ZSB9XG4gICAgY29uc3QgW3RhYl0gPSBhd2FpdCBjaHJvbWUudGFicy5xdWVyeShxdWVyeU9wdGlvbnMpXG4gICAgY29uc29sZS5sb2coe3RhYn0pXG4gICAgcmV0dXJuIHRhYlxufVxuIl0sIm5hbWVzIjpbIiRiNDEyNzllNDE5NGJhOWI5JGV4cG9ydCRhN2RiMDY2NjhjYWQ5YWRiIiwiYXBpS2V5Iiwic29ja2V0IiwiY2hyb21lIiwic3RvcmFnZSIsImxvY2FsIiwic2V0IiwidHJhbnNjcmlwdCIsImdldCIsImtleSIsIm5hdmlnYXRvciIsIm1lZGlhRGV2aWNlcyIsImdldERpc3BsYXlNZWRpYSIsInZpZGVvIiwiYXVkaW8iLCJ0aGVuIiwic3RyZWFtIiwiYWxlcnQiLCJnZXRBdWRpb1RyYWNrcyIsImxlbmd0aCIsIk1lZGlhUmVjb3JkZXIiLCJpc1R5cGVTdXBwb3J0ZWQiLCJtZWRpYVJlY29yZGVyIiwibWltZVR5cGUiLCJXZWJTb2NrZXQiLCJvbm9wZW4iLCJjb25zb2xlIiwibG9nIiwiZXZlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYXN5bmMiLCJkYXRhIiwic2l6ZSIsInJlYWR5U3RhdGUiLCJzZW5kIiwic3RhcnQiLCJvbm1lc3NhZ2UiLCJtZXNzYWdlIiwiSlNPTiIsInBhcnNlIiwiY2hhbm5lbCIsImFsdGVybmF0aXZlcyIsInJ1bnRpbWUiLCJzZW5kTWVzc2FnZSIsImNhdGNoIiwiZXJyIiwib25NZXNzYWdlIiwiYWRkTGlzdGVuZXIiLCJjbG9zZSIsIiQ0MTJlNGE5N2UwZGE3YWRiJHZhciRzaG93TGF0ZXN0VHJhbnNjcmlwdCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJyZW1vdmVBdHRyaWJ1dGUiLCIkNDEyZTRhOTdlMGRhN2FkYiR2YXIkZ2V0Q3VycmVudFRhYiIsInRhYiIsInRhYnMiLCJxdWVyeSIsImFjdGl2ZSIsImxhc3RGb2N1c2VkV2luZG93Iiwic2NyaXB0aW5nIiwiZXhlY3V0ZVNjcmlwdCIsInRhcmdldCIsInRhYklkIiwiaWQiLCJmdW5jIiwiZGlzYWJsZWQiXSwidmVyc2lvbiI6MywiZmlsZSI6InBvcHVwLkhBU0hfUkVGX2VhY2I2YWFiNmM4Yzg5NTAuanMubWFwIn0=
